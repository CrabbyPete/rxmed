<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<title>RxMedAccess, LLC</title>
<link rel="shortcut icon" type="image/png" href="{{url_for('static',filename='img/favicon (32x32).png')}}"/>
<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<!-- Custom styles -->
<!--<link href="stylesheet.css" rel="stylesheet">-->
<link href="{{url_for('static',filename='css/stylesheet.css')}}" rel="stylesheet">
</head>
<body>
<!-- Loader -->
<div id="screen"></div>
<div id="loading"></div>
<!-- Navigation bar -->

<!--<nav class="navbar navbar-expand-md navbar-light bg-light"> <a class="navbar-brand" href="/"><img src="logo transparent(1000x682).png" width="90vw" alt="RxMedAccess, LLC"></a>-->
<nav class="navbar navbar-expand-md navbar-light bg-light"> <a class="navbar-brand" href="/"><img src="{{url_for('static',filename='img/logo transparent(1000x682).png')}}" width="90vw" alt="RxMedAccess, LLC"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
  <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item"> <a class="nav-link" href="/patients">Patients</a> </li>
      <li class="nav-item"> <a class="nav-link" href="/providers">Providers</a> </li>
      <li class="nav-item"> <a class="nav-link" href="/about">About Us</a> </li>
    </ul>
  </div>
</nav>

<!-- Main -->
<div class="container text-center m-5 px-5">
  <h1 class="mb-4" id="fit">Formulary Insight / Therapeutic Alternatives Tool</h1>
  <p class="px-5">Instantly gain insight on your patients' medications and save more time with our combined Formulary Insight and Therapeutic Alternatives tools.</p>
  <p class="px-5">First, select your patient's appropriate health coverage between Medicare or Medicaid. Once you've filled a form, click its corresponding "Go" button to finalize your selection. If you have changed a selection, simply click its "Go" button again. Once all the forms have been filled, click the "View Formulary Insight" button to generate your patient's personalized table.</p>
</div>

<!-- Select health coverage -->
<h5 class="text-center">Select a health plan type:</h5>
<div class="row justify-content-center m-3">
  <button type="button" class="btn btn-primary med-button mx-3" id="button-medicare">Medicare</button>
  <button type="button" class="btn btn-primary med-button mx-3" id="button-medicaid">Medicaid</button>
</div>
<!-- Form -->
<main class="container m-5">
  <div class="form-row m-5">

    <!-- Zipcode -->
    <form class="input-group" id="form-zipcode">
      <label for="input-zipcode" class="mr-1"><span class="input-group-text">Zipcode</span></label>
      <input class="form-control mb-3" type="text" placeholder="ex. 12345" autocomplete="off" id="input-zipcode">
      <button type="button" class="btn btn-primary ml-1" id="button-go-zipcode">Go</button>
    </form>

    <div class="container text-center m-2" id="container-selected-zipcode">
      <h6>You have entered:</h6>
      <h5 id="selected-zipcode">Nothing yet!</h5>
    </div>

    <!-- Plan -->
    <form class="input-group" id="form-plan">
      <label for="input-plan" class="mr-1"><span class="input-group-text">Plan Name</span></label>
      <input class="form-control" autocomplete="off" placeholder="Type to search..." id="input-plan">
      </input>
      <button type="button" class="btn btn-primary ml-1" id="button-go-plan">Go</button>
    </form>

    <div class="container text-center m-2" id="container-selected-plan">
      <h6>You have selected:</h6>
      <h5 id="selected-plan">Nothing yet!</h5>
    </div>

    <!-- Medication -->
    <form class="input-group" id="form-med" id="container-selected-med">
    <label for="input-med" class="mr-1"><span class="input-group-text">Medication</span></label>
    <input class="form-control" autocomplete="off" placeholder="Type to search..." id="input-med">
    </input>
    <button type="button" class="btn btn-primary ml-1" id="button-go-med">Go</button>
    </form>
    <div class="container text-center m-2">
      <h6>You have selected:</h6>
      <h5 id="selected-med">Nothing yet!</h5>
    </div>
  </div>
  <!-- Form final buttons -->
  <div class="row justify-content-center">
    <button type="submit" class="btn btn-primary font-weight-bold m-2" id="button-generate">View Formulary Coverage</button>
    <button type="reset" class="btn btn-primary m-2" id="button-clear-med">Clear Medication</button>
    <button type="reset" class="btn btn-primary m-2" id="button-clear-all">Clear All</button>
  </div>

  <!-- Table -->
  <div class="row justify-content-center mt-5">
    <h1 id="table-header">Placeholder</h1>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered" id="table-medicare">
      <thead>
        <tr>
          <th scope="col">Brand (proprietary name)</th>
          <th scope="col">Generic (non-proprietary name)</th>
          <th scope="col">Tier</th>
          <th scope="col">ST</th>
          <th scope="col">QL</th>
          <th scope="col">PA</th>
          <th scope="col">Copay (pre-deductible)</th>
          <th scope="col">Copay (deductible met)</th>
        </tr>
      </thead>
      <tbody id="medicarebody">
      </tbody>
    </table>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered" id="table-medicaid">
      <thead>
        <tr>
          <th scope="col">Drug Name</th>
          <th scope="col">Drug Tier</th>
          <th scope="col">Formulary Restriction</th>
        </tr>
      </thead>
      <tbody id="medicaidbody">

      </tbody>
    </table>
  </div>
</main>
<div class="card-footer mt-5">Â© 2017 - 2019 RxMedAccess, LLC</div>
<!-- /.container --> 
<!-- Scripts --> 
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script> 
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script> 
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script> 
<script>

  $(function () {
	  /***** Loader *****/
	  setTimeout(function() {($('#loading').hide(), $('#screen').remove())}, 1 * 1000);
	  $(document).ajaxStart(function () {
		  $('#screen').show(),
		  $('#loading').show()
	  }).ajaxStop(function () {
		  $('#screen').hide(),
		  $('#loading').hide()
	  });

	  /***** Variables and helper functions *****/
	  $('main').hide();
	  $('#table-header').hide();
	  $('#table-medicare').hide();
	  $('#table-medicaid').hide();
	  var medicareSelected;
	  var medicaidSelected;
	  var zipcode = '';
	  var plan = '';
	  var drug = '';

	  $.fn.toggleButtonOn = function() 
	  {
		  $(this).css("background-color", "#8cc63e"),
	      $(this).css("border-color", "#8cc63e")
	  };

	  $.fn.toggleButtonOff = function() 
	  {
		  $(this).css("background-color", "#0069a3"),
	      $(this).css("border-color", "#0069a3")
	  };

	  /***** Autocomplete functionality *****/
      $("#input-plan").autocomplete({
		  source: function( request, response )
		  {
			  zipcode = $("#input-zipcode").val();
			  $.ajax(
				  {
					  url: "/plans",
					  dataType: "json",
					  data: {qry: request.term, zipcode: zipcode},
					  success: function( data )
					  {
						  response( data )
					  }
				  });
		  }
	  });

      $( "#input-med" ).autocomplete({
		  source: function( request, response )
		  {
			  $.ajax(
				  {
					  url: "/drug_names",
					  dataType: "json",
					  data: {qry: request.term },
					  success: function( data )
					  {
						  response( data )
					  }
				  });
		  }
	  });
	  /***** Medicare/medicaid button toggles *****/

	  $('#button-medicare').click(function ()
      {
		  medicareSelected = true;
		  medicaidSelected = false;
		  $('#button-medicare').toggleButtonOn();
		  $('#button-medicaid').toggleButtonOff();
		  $('main').show();
		  $('#form-zipcode').show();
		  $('#container-selected-zipcode').show();
		  $('html').clearAllInput();
	  });

	  $('#button-medicaid').click(function () 
      {
		  medicaidSelected = true;
		  medicareSelected = false;
		  $('#button-medicaid').toggleButtonOn();
		  $('#button-medicare').toggleButtonOff();
		  $('main').show();
		  $('#form-zipcode').hide();
		  $('#container-selected-zipcode').hide();
		  $('html').clearAllInput();
	  });

	  /***** Go buttons *****/
	  $('#button-go-zipcode').click(function () 
      {
		  var input = $('#input-zipcode').val()
		  if (input.length == 5 && $.isNumeric(input)) 
		  {
			  zipcode = input;
			  $('#selected-zipcode').html(zipcode)
		  } else 
		  {
			  alert("Error: Enter a valid zipcode.");
		  }
	  })

	  $('#button-go-plan').click(function () 
	  {
		  var input = $('#input-plan').val()
		  if (input.length > 0) 
		  {
			  plan = input;
			  $('#selected-plan').html(plan);
		  } else 
		  {
			  alert("Error: Select a plan.");
		  }
	  })

	  $('#button-go-med').click(function () 
	  {
		  var input = $('#input-med').val();
		  if (input.length > 0) 
		  {
			  drug = input;
			  $('#selected-med').html(drug);
		  } else 
		  {
			  alert("Error: Select a medication.");
		  }
	  })

	  /***** Generate formulary insight *****/
	  generateMedicareResults = function ()
	  {
		  $.ajax
		  ({
			  url: "/medicare_options",
			  async: false,
			  dataType: "json",
			  data: {zipcode: zipcode, drug_name: drug, plan_name: plan},
			  success: function( resp )
			  {
				  for( d=0; d < resp.length; d++)
				  {
					  var tr = 
						  (
						  '<tr>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '<td>' + '</td>' +
						  '</tr>'
						  );
					  $("#medicaid-body").append(tr)

				  }
				  $('#table-header').show();
				  $('#table-medicaid').show();
			  }
		  });
	  }

	  generateMedicaidResults = function ()
	  {
		  $.ajax
		  ({
			  url: "/medicaid_options",
			  async: false,
			  dataType: "json",
			  data: {drug_name: drug, plan_name: plan},
			  success: function( resp )
			  {
				  for( d=0; d < resp.length; d++)
				  {
					  if( resp[d].Formulary_Restrictions.search('PA') )
					    cls = '<td class="table-success">';
					  else
					    cls = '<td class="table-danger">';
					    
					  var tr =
						  (
						  '<tr id="medicaid-success">' +
						  cls + resp[d].Drug_Name+ '</td>' +
						  cls + resp[d].Drug_Tier+ '</td>' +
						  cls + resp[d].Formulary_Restrictions+ '</td>' +
						  '</tr>'
						  );

					  $('#medicaidbody').append(tr);

				  }
				  $('#table-medicaid').show();
				  $('#table-header').show();
			  }
		  });
	  }
	  $('#button-generate').click(function () 
      {
		  if ((medicareSelected && zipcode.length == 0) || (plan.length == 0 || drug == 0)) 
		  {
			  alert("Error: One or more fields is missing. Make sure you have pressed the \"Go\" button after each field.");
		  } else 
		  {
			  $('#table-header').text(drug);
			  $('#table-header').show();
			  document.getElementById('table-header').scrollIntoView();
			  if (medicareSelected) 
			  {
				  generateMedicareResults();
			  } else 
			  {
				  generateMedicaidResults();
			  }
		  }
	  })

	  /***** Clear buttons *****/
	  $.fn.clearAllInput = function ()
	  {
		  $('#table-header').hide(),
		  $('#table-medicare').hide(),
		  $('#table-medicaid').hide(),
		  $('#input-zipcode').val(''),
		  $('#input-plan').val(''),
		  $('#input-med').val(''),
		  zipcode = '',
		  plan = '',
		  drug = '',
		  $('#selected-zipcode').html("Nothing yet!"),
		  $('#selected-plan').html("Nothing yet!"),
		  $('#selected-med').html("Nothing yet!")
	  }
	  $('#button-clear-med').click(function () 
      {
		  $('#input-med').val(''),
		  drug = '',
		  $('#selected-med').html("Nothing yet!")
	  })
	  $('#button-clear-all').click(function ()
      {
		  $('main').hide(),
		  $('html').clearAllInput();
		  if (medicareSelected) 
		  {
			  $('#button-medicare').toggleButtonOff(),
			  medicareSelected = false
		  } else 
		  {
			  $('#button-medicaid').toggleButtonOff()
			  medicaidSelected = false
		  }
	  })
  });
</script>
</body>
</html>
